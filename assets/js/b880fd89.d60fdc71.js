"use strict";(self.webpackChunkdocta=self.webpackChunkdocta||[]).push([[2316],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,m=d["".concat(s,".").concat(h)]||d[h]||p[h]||r;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2603:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>k,frontMatter:()=>c,metadata:()=>d,toc:()=>h});var a=n(7462),o=(n(7294),n(3905)),r=n(1026),i=n(3872),l=n(4456),s=n(2915);const c={template:"post",draft:!1,hide_title:!0,title:"Running a node in a Docker container",slug:"fleek-network-running-a-node-in-a-docker-container",image:"./assets/fleek-network-docker-setup-overview.png?202301111625",date:new Date("2022-12-05T23:00:00.000Z"),canonical:"",description:"A guide on how to run Fleek Network's node in a docker container",category:"Tutorial",tags:["DCDN","Guide","Getting Started","Fleek Network","Docker"]},u=void 0,d={unversionedId:"Network nodes/fleek-network-running-a-node-in-a-docker-container",id:"Network nodes/fleek-network-running-a-node-in-a-docker-container",title:"Running a node in a Docker container",description:"A guide on how to run Fleek Network's node in a docker container",source:"@site/guides/Network nodes/fleek-network-running-a-node-in-a-docker-container.mdx",sourceDirName:"Network nodes",slug:"/Network nodes/fleek-network-running-a-node-in-a-docker-container",permalink:"/guides/Network nodes/fleek-network-running-a-node-in-a-docker-container",draft:!1,editUrl:"https://github.com/fleek-network/fleek-network-docs/edit/main/guides/Network nodes/fleek-network-running-a-node-in-a-docker-container.mdx",tags:[{label:"DCDN",permalink:"/guides/tags/dcdn"},{label:"Guide",permalink:"/guides/tags/guide"},{label:"Getting Started",permalink:"/guides/tags/getting-started"},{label:"Fleek Network",permalink:"/guides/tags/fleek-network"},{label:"Docker",permalink:"/guides/tags/docker"}],version:"current",lastUpdatedAt:1675259277,formattedLastUpdatedAt:"Feb 1, 2023",frontMatter:{template:"post",draft:!1,hide_title:!0,title:"Running a node in a Docker container",slug:"fleek-network-running-a-node-in-a-docker-container",image:"./assets/fleek-network-docker-setup-overview.png?202301111625",date:"2022-12-05T23:00:00.000Z",canonical:"",description:"A guide on how to run Fleek Network's node in a docker container",category:"Tutorial",tags:["DCDN","Guide","Getting Started","Fleek Network","Docker"]},sidebar:"defaultSidebar",previous:{title:"How to deal with files using Content Addressable aRchives",permalink:"/guides/Network nodes/fleek-network-packing-content-addressed-data"},next:{title:"Securing a node with SSL/TLS",permalink:"/guides/Network nodes/fleek-network-securing-a-node-with-ssl-tls"}},p={image:n(4852).Z},h=[{value:"Introduction",id:"introduction",level:2},{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"For the impatient \ud83d\ude24",id:"for-the-impatient-",level:2},{value:"Quick Video",id:"quick-video",level:2},{value:"Setup",id:"setup",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Ursa CLI source-code",id:"ursa-cli-source-code",level:3},{value:"Install Docker desktop",id:"install-docker-desktop",level:3},{value:"Recommended settings",id:"recommended-settings",level:3},{value:"Image",id:"image",level:2},{value:"Build the Docker image",id:"build-the-docker-image",level:3},{value:"Container",id:"container",level:2},{value:"Run the container from the official nightly image",id:"run-the-container-from-the-official-nightly-image",level:3},{value:"Run the Docker container",id:"run-the-docker-container",level:3},{value:"Ursa healthcheck",id:"ursa-healthcheck",level:3},{value:"Utility commands",id:"utility-commands",level:2},{value:"Stop the Docker container",id:"stop-the-docker-container",level:3},{value:"Restart the Docker container",id:"restart-the-docker-container",level:3},{value:"Delete the Docker container",id:"delete-the-docker-container",level:3},{value:"Execute Ursa CLI commands in the container",id:"execute-ursa-cli-commands-in-the-container",level:3},{value:"Execute bash shell in the container",id:"execute-bash-shell-in-the-container",level:3},{value:"Run the container from the recommended stack",id:"run-the-container-from-the-recommended-stack",level:2},{value:"Running a stack with Docker compose",id:"running-a-stack-with-docker-compose",level:3},{value:"Disabling SSL for testing",id:"disabling-ssl-for-testing",level:3},{value:"Conclusion",id:"conclusion",level:2}],m={toc:h};function k(e){let{components:t,...c}=e;return(0,o.kt)("wrapper",(0,a.Z)({},m,c,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Fleek Network: Running a node in a Docker container",src:n(4852).Z,width:"1200",height:"628"})),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Our ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/images/"},"image")," provides all the requirements to have Fleek Network running quickly \ud83c\udf08 and the following guide will provide you a quick reference to get you started with Docker \ud83d\udd25! "),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR")," If you have Docker experience then you'll find ours ",(0,o.kt)("a",{parentName:"p",href:"#for-the-impatient"},"for the impatient")," more satisfying!"),(0,o.kt)("p",null,"Alternatively, if you need a deep dive into Docker, check the official getting started ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/get-started/"},"here"),"."),(0,o.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,o.kt)("p",null,"To follow the guide, you will need the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Familiarity with the command-line interface"),(0,o.kt)("li",{parentName:"ul"},"Git")),(0,o.kt)(r.ZP,{mdxType:"CheckoutCommitWarning"}),(0,o.kt)("h2",{id:"for-the-impatient-"},"For the impatient \ud83d\ude24"),(0,o.kt)("p",null,"For the one's interested in running the node as quickly as possible, there are a few options, among those we pick two you might find handy:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"A Docker compose Stack, which is an opinionated stack that provides a reverse proxy service for the Node (Proxied internal ",(0,o.kt)("inlineCode",{parentName:"p"},"4069")," to external ports ",(0,o.kt)("inlineCode",{parentName:"p"},"80")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"443"),"), a service to enable HTTPS on your server, services for monitoring and analytics, etc. You can run a stack quickly by following the instructions in ",(0,o.kt)("a",{parentName:"p",href:"#run-the-container-from-the-recommended-stack"},"run the container from the recommended stack"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Building a Docker image requires some effort and some of our users might find it easier to pull our nightly image for quick access to Ursa, which does not require them to build from source. For that reason, we provide you with a quick demonstration of how to pull the image and run the Docker container quickly! Check the ",(0,o.kt)("a",{parentName:"p",href:"#run-the-container-from-the-official-nightly-image"},"run the container from the official nightly image")))),(0,o.kt)("p",null,"At some point in time you will have to look at the how things work and figure out what abstractions did wrong. For some advanced users that are used to it is not a big deal, but for everyone else that might cause quite a lot of hassle! Therefore, challenge yourself to learn the basics instead of executing commands you are yet to understand, this guide is your friend!"),(0,o.kt)("h2",{id:"quick-video"},"Quick Video"),(0,o.kt)("p",null,"A walkthrough video is provided as a quick reference for the users, we try to keep it simple and would suggest the text guide version to get more detailed information. "),(0,o.kt)("p",null,"The video content is stored in our Fleek Network ",(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=uAFIDu3UBvw&list=PL3v9ZaTBrN9GEQ2NmS5xc6YH0E2df5VTn"},"playlist")," on the Fleek XYZ ",(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/@fleekxyz"},"Youtube channel"),"."),(0,o.kt)(l.Z,{title:"Running a node in a Docker container",videoId:"uAFIDu3UBvw",mdxType:"YoutubePlayer"}),(0,o.kt)("p",null,"How do you find the video content? Help us improve by sending feedback in our Discord channel ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"here"),"."),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("h3",{id:"requirements"},"Requirements"),(0,o.kt)("p",null,"To follow the guide successfully, a good amount of memory and disk space is necessary to run Docker. The main reason for our use-case is that your host machine requires a generous amount of memory and disk space, for the containers."),(0,o.kt)("p",null,"Here's a quick look into the resources used during runtime (very quiet usage \ud83d\ude34 at time of writing):"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"CPU %"),(0,o.kt)("th",{parentName:"tr",align:null},"Memory usage / Limit"),(0,o.kt)("th",{parentName:"tr",align:null},"Mem %"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"ursa-cli"),(0,o.kt)("td",{parentName:"tr",align:null},"1.06%"),(0,o.kt)("td",{parentName:"tr",align:null},"49.7MiB / 7.775GiB"),(0,o.kt)("td",{parentName:"tr",align:null},"0.62%")))),(0,o.kt)("p",null,"In the example, for this guide, we have 8 GB spare memory and 20 GB spare disk space that we'll set up Docker to run our node! You'll find more about that later in the ",(0,o.kt)("a",{parentName:"p",href:"#recommended-settings"},"recommended settings")," section."),(0,o.kt)("h3",{id:"ursa-cli-source-code"},"Ursa CLI source-code"),(0,o.kt)("p",null,"Start by cloning the repository located at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa",title:"https://github.com/fleek-network/ursa"},"https://github.com/fleek-network/ursa"),"."),(0,o.kt)(s.ZP,{mdxType:"GitCloneOptions"}),(0,o.kt)("p",null,"The command will copy the repository files to your local machine, by default into a directory by the name of the repository ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa"),"."),(0,o.kt)("p",null,"When git clone completes \ud83d\udc4d, ",(0,o.kt)("inlineCode",{parentName:"p"},"change directory")," to the project directory e.g. we cloned to the default name ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cd ursa\n")),(0,o.kt)("p",null,"If you list (",(0,o.kt)("inlineCode",{parentName:"p"},"ls"),") the files in the directory, it should be similar to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},".\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 crates\n\u251c\u2500\u2500 infra\n\u251c\u2500\u2500 rust-toolchain.toml\n\u2514\u2500\u2500 specs\n")),(0,o.kt)("h3",{id:"install-docker-desktop"},"Install Docker desktop"),(0,o.kt)("p",null,"The simplest way to run docker is to visit the ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"https://www.docker.com/"),", download and install Docker Desktop."),(0,o.kt)("p",null,"\ud83d\udca1 Some users might prefer to look into the Docker daemon (dockerd), in that case, check the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com"},"docs"),", as we're trying to keep it simple here!"),(0,o.kt)("p",null,"Once Docker desktop is installed, you should start or open the application in your operating system! "),(0,o.kt)("p",null,"Also, you'll be able to run it via the CLI, as such:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker -v\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Docker version 20.10.6, build 370c289\n")),(0,o.kt)("p",null,"Let's do the same for ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -v\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose version 1.29.1, build c34c88b2\n")),(0,o.kt)("p",null,"\ud83d\udca1 Versions might differ a bit from the time of writing."),(0,o.kt)("p",null,"The following command's output will indicate if Docker's working correctly:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run hello-world\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"Unable to find image 'hello-world:latest' locally\nlatest: Pulling from library/hello-world\n2db29710123e: Pull complete \nDigest: sha256:faa03e786c97f07ef34423fccceeec2398ec8a5759259f94d99078f264e9d7af\nStatus: Downloaded newer image for hello-world:latest\n\nHello from Docker!\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\n\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\n\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\n\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n")),(0,o.kt)("p",null,"Run all the commands above in your terminal, to confirm everything's working before proceeding to the next steps, please! \ud83d\udc4d "),(0,o.kt)("h3",{id:"recommended-settings"},"Recommended settings"),(0,o.kt)("p",null,"As mentioned in the ",(0,o.kt)("a",{parentName:"p",href:"#requirements"},"requirements")," you'll need enough disk space and memory to run containers successfully."),(0,o.kt)("p",null,"As an example, during build time, the minimum memory required is about 8 GB! If you do not have enough memory configured in the Docker preferences, you might encounter errors, such as:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'#13 139.1    Compiling actix-web v4.2.1\n#13 143.4    Compiling jsonrpc-v2 v0.11.0\n#13 183.5 The following warnings were emitted during compilation:\n#13 183.5 \n#13 183.5 warning: c++: fatal error: Killed signal terminated program cc1plus\n#13 183.5 warning: compilation terminated.\n#13 183.5 \n#13 183.5 error: failed to run custom build command for `librocksdb-sys v0.8.0+7.4.4`\n#13 183.5 \n#13 183.5 Caused by:\n#13 183.6   process didn\'t exit successfully: `/usr/src/app/target/release/build/librocksdb-sys-c0aabb249f648650/build-script-build` (exit status: 1)\n#13 183.6   --- stdout\n#13 183.6   cargo:rerun-if-changed=rocksdb/\n#13 183.6   TARGET = Some("x86_64-unknown-linux-gnu")\n#13 183.6   OPT_LEVEL = Some("z")\n#13 183.6   HOST = Some("x86_64-unknown-linux-gnu")\n#13 183.6   cargo:rerun-if-env-changed=CXX_x86_64-unknown-linux-gnu\n')),(0,o.kt)("p",null,'If you are running Docker desktop application, open the dashboard settings and in the "resources" change the memory to the recommended size 8 GB. If you need instructions to locate the settings page, visit the Docker official documentation, here\'s an example for ',(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/desktop/settings/linux"},"Linux")," and ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/desktop/settings/macos"},"MacOS"),"."),(0,o.kt)("p",null,"Make sure that you have configured Docker desktop with the ",(0,o.kt)("a",{parentName:"p",href:"#recommended-settings"},"recommended settings"),", before proceeding any further!"),(0,o.kt)("h2",{id:"image"},"Image"),(0,o.kt)("p",null,"A Docker image is a read-only template with instructions for creating a Docker container, like a template. Docker images also act as a the starting point when using Docker. "),(0,o.kt)("p",null,'The starting point for our use-case is a Dockerfile, where all those "template instructions" are declared.'),(0,o.kt)("p",null,"Here's how our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/22de01ecb4be347e2b76f17e4e40e4fd9956e69b/Dockerfile"},"Dockerfile")," looks like."),(0,o.kt)("h3",{id:"build-the-docker-image"},"Build the Docker image"),(0,o.kt)("p",null,"We are assuming \ud83d\ude05 that you've followed our ",(0,o.kt)("a",{parentName:"p",href:"fleek-network-getting-started-guide"},"Fleek Network: Getting started guide")," and have successfully cloned the ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," repository. If you haven't give it a go, before you proceed!"),(0,o.kt)("p",null,"The reason is that the image builder requires the source files as the input file to have information to build a container, as mentoned ",(0,o.kt)("a",{parentName:"p",href:"#image"},"earlier"),". "),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/22de01ecb4be347e2b76f17e4e40e4fd9956e69b/Dockerfile"},"Dockerfile")," is located in the Ursa repository (at time of writing), ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/22de01ecb4be347e2b76f17e4e40e4fd9956e69b/Dockerfile"},"here"),"."),(0,o.kt)("p",null,"If you have cloned the project correctly, you should ",(0,o.kt)("inlineCode",{parentName:"p"},"change directory")," to the project root directory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cd <PATH-TO-URSA-DIRECTORY>\n")),(0,o.kt)("p",null,"Example, ours is located at ",(0,o.kt)("inlineCode",{parentName:"p"},"/Users/fleek/ursa"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cd /Users/fleek/ursa\n")),(0,o.kt)("p",null,"At time of writing, this is how the project root looks like (e.g. use the ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Ls"},"ls")," to see the list):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},".\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 crates\n\u251c\u2500\u2500 infra\n\u251c\u2500\u2500 rust-toolchain.toml\n\u2514\u2500\u2500 specs\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Double-check that your work directory is in the project root. You'll build the Docker image based in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/32928e78afa0bbed8241ddc4d7e2456752456fd6/Dockerfile"},"Dockerfile"),".")),(0,o.kt)("p",null,"When ready, run the Docker build command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker build -t ursa -f ./Dockerfile .\n")),(0,o.kt)("p",null,"The build process takes awhile and you have to wait for completion. "),(0,o.kt)("p",null,"\ud83e\udd16 The output should be similar to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[+] Building 16.1s (8/16)                                                                                                                           \n => [internal] load build context                                                                                                              0.2s\n => => transferring context: 12.95MB                                                                                                           0.2s\n => [builder 1/6] FROM docker.io/library/rust:latest@sha256:6d44ed87fe759752c89d1f68596f84a23493d3d3395ed843d3a1c104866e5d9e                  13.5s\n => => resolve docker.io/library/rust:latest@sha256:6d44ed87fe759752c89d1f68596f84a23493d3d3395ed843d3a1c104866e5d9e                           0.0s\n => => sha256:6d44ed87fe759752c89d1f68596f84a23493d3d3395ed843d3a1c104866e5d9e 988B / 988B                                                     0.0s\n => => sha256:6c20d87766142d058f3e21874fe1db426c49ce3e1575c8c300fdc27d06db92a9 1.59kB / 1.59kB                                                 0.0s\n => => sha256:c85a0be79bfba309d1f05dc40b447aa82b604593531fed1e7e12e4bef63483a5 10.88MB / 10.88MB                                              10.1s\n => => sha256:c7bf205db148c9f9202dbece143e86487c678d108c3936897cfd9bcd7915dd3c 6.42kB / 6.42kB                                                 0.0s\n")),(0,o.kt)("p",null,"\u26a0\ufe0f The Docker image is only required to be built once and/or, when changes are pulled from the remote repository, or versions you might be interested in! Otherwise, you're not required to build it everytime to run the node. If you'd like to learn how to update the Ursa CLI, find our guide ",(0,o.kt)("a",{parentName:"p",href:"#fleek-network-how-to-get-the-latest-updates-for-ursa-cli-from-the-source-repository"},"here"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Bear in mind that if you don't update your build often, you won't have the latest changes, which happen frequently with all the ongoing development! This is quite important to understand, as it causes confusion to some users. The Ursa application at time of writing does not update automatically.")),(0,o.kt)("h2",{id:"container"},"Container"),(0,o.kt)("p",null,"A container is what's originated from the image we discussed ",(0,o.kt)("a",{parentName:"p",href:"#image"},"earlier"),", it is a runnable instance of an image! We can create, start, stop, move, or delete a container using the Docker API or CLI."),(0,o.kt)("p",null,"Following up, we'll learn how to run the Docker container that includes our ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," program, built from our source ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/32928e78afa0bbed8241ddc4d7e2456752456fd6/Dockerfile"},"Dockerfile"),"."),(0,o.kt)("p",null,"\ud83d\udce2 We've been referencing the Dockerfile to a particular commit hash in our repository, to secure the pointer to it, but you are free to check any commit message, including the latest version of our main branch! This is explained in our guide to help you update the Ursa CLI source and binary ",(0,o.kt)("a",{parentName:"p",href:"#fleek-network-how-to-get-the-latest-updates-for-ursa-cli-from-the-source-repository"},"here"),"."),(0,o.kt)("h3",{id:"run-the-container-from-the-official-nightly-image"},"Run the container from the official nightly image"),(0,o.kt)("p",null,"The Fleek Network Ursa image is built nightly, and some of our users might find handy to pull it instead of building it for quick access to a running node!"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The official ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/pkgs/container/ursa"},"fleek-network/ursa:nightly")," image is currently hosted in Github's container registry and updated every night, you can ",(0,o.kt)("inlineCode",{parentName:"p"},"docker pull")," the image and run it locally. Beware that the version is built at a particular time of the day, so if you are looking for a custom image then you're better off learning how to build one yourself. The extended guide provides you all the information you need, but we also have a guide on how to update images that you may be interested in reading ",(0,o.kt)("a",{parentName:"p",href:"fleek-network-packing-content-addressed-data"},"here"))),(0,o.kt)("p",null,"Firstly, start by running the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker pull"),", as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker pull ghcr.io/fleek-network/ursa:nightly\n")),(0,o.kt)("p",null,"\u26a0\ufe0f Important: The Github container registry is private, you need a Github account and private token to login via the CLI to be able to pull, find the instructions ",(0,o.kt)("a",{parentName:"p",href:"https://ghcr.io/"},"here"),"."),(0,o.kt)("p",null,"Once the Docker image is downloaded completely, you can run a container based on the image:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -p 4069:4069 -p 6009:6009 -v $HOME/.ursa/:/root/.ursa/:rw --name ursa-cli -it ghcr.io/fleek-network/ursa:nightly\n")),(0,o.kt)("p",null,"Notice that the command arguments we pass are for the flag's ",(0,o.kt)("inlineCode",{parentName:"p"},"-p")," for port numbers, ",(0,o.kt)("inlineCode",{parentName:"p"},"-v")," to bind mount a location in your host to a container path (useful to persist your ursa configuration files, e.g. keystore), ",(0,o.kt)("inlineCode",{parentName:"p"},"--name")," to make it easier to identify, ",(0,o.kt)("inlineCode",{parentName:"p"},"-it")," to make it interactive (e.g. presents output to the terminal), and the image name we pulled earlier (ghcr.io/fleek-network/ursa:nightly), if you hadn't pulled and not found, docker would pull it for you."),(0,o.kt)("p",null,"You can then do a quick healthcheck as described ",(0,o.kt)("a",{parentName:"p",href:"#ursa-healthcheck"},"here"),"."),(0,o.kt)("p",null,"For more detailed information, such as the commands explained, port numbers, output example, etc, read the ",(0,o.kt)("a",{parentName:"p",href:"#run-the-docker-container"},"run the Docker container"),"."),(0,o.kt)("h3",{id:"run-the-docker-container"},"Run the Docker container"),(0,o.kt)("p",null,"Once the Docker image is ready \u2705, you can run it by providing a container and image name!"),(0,o.kt)("p",null,"Since we want to interact with the process ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa"),", we'll run in interactive mode by using the flags ",(0,o.kt)("inlineCode",{parentName:"p"},"-it"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -p 4069:4069 -p 6009:6009 -v $HOME/.ursa/:/root/.ursa/:rw --name ursa-cli -it ursa\n")),(0,o.kt)("p",null,"We are providing a custom name of our liking (ursa-cli) for the container and the image name we have built previously (ursa). Also, we do a bind mount to mount a file or directory on the host machine into a container, as an example, this is useful to persist the configuration for the identity. Find more on managing the identity ",(0,o.kt)("a",{parentName:"p",href:"#fleek-network-managing-the-key-store"},"here"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run [-p <HOST-PORT>:<CONTAINER-PORT>] --name <CONTAINER-NAME> -v <HOST-PATH>:<CONTAINER-PATH> -it <IMAGE>\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\ud83d\udca1 We understand these commands might be hard to remember and provide some utility commands for your convenience. Although, if you need naming, port customisation, then you can stick with the knowledge you've acquired, or use this document as a reference. The utility commands require ",(0,o.kt)("a",{parentName:"p",href:"https://www.gnu.org/software/make/manual/make.html"},"make"),", most operating systems have it installed by default, otherwise you can use a web search engine to find instructions on how to install it in your operating system.")),(0,o.kt)("p",null,"The utility commands are the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-build")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-run"),"."),(0,o.kt)("p",null,"Respectively, execute ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-build")," to build the Docker image:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"make docker-build\n")),(0,o.kt)("p",null,"Execute the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-run")," to run the Docker container based on the built image:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"make docker-run\n")),(0,o.kt)("p",null,"\u26a0\ufe0f At the time of writing the ",(0,o.kt)("inlineCode",{parentName:"p"},"make docker-run")," does not persist the Ursa configuration (",(0,o.kt)("a",{parentName:"p",href:"#fleek-network-managing-the-key-store"},"options, key store, identity"),", etc), you'd be better off executing the actual ",(0,o.kt)("inlineCode",{parentName:"p"},"docker run")," command without the sugar coating for better control and sanity check! This happens because the ",(0,o.kt)("inlineCode",{parentName:"p"},"-v <HOST-PATH>:<CONTAINER-PATH>")," bind mount is missing in the makefile declaration ",(0,o.kt)("inlineCode",{parentName:"p"},"make docker-run"),", this can change at any time so be wary of commands that create unnecessary abstractions! On the other hand, you might find it useful to use our ",(0,o.kt)("a",{parentName:"p",href:"#running-a-stack-with-docker-compose"},"proposed stack")," which has the appropriate binding mounts for you."),(0,o.kt)("p",null,"\ud83d\udca1 Remember, the utility commands will use default naming and port numbers. Use the original Docker commands for better control or customization."),(0,o.kt)("p",null,"If all goes well, the output should be similar to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'2022-12-05T17:06:25.943684Z  INFO ursa: UrsaConfig: UrsaConfig { mdns: false, relay_server: true, autonat: true, relay_client: true, swarm_addr: "/ip4/0.0.0.0/tcp/6009", bootstrap_nodes: ["/ip4/159.223.211.234/tcp/6009/p2p/12D3KooWDji7xMLia6GAsyr4oiEFD2dd3zSryqNhfxU3Grzs1r9p", "/ip4/146.190.232.131/tcp/6009/p2p/12D3KooWGw8vCj9XayJDMXUiox6pCUFm7oVuWkDJeE2H9SDQVEcM"], database_path: Some("ursa_db"), identity: "default", keystore_path: "/root/.config/ursa/keystore" }\n2022-12-05T17:06:25.944223Z ERROR ursa::ursa::identity: Failed to load identity `No such file or directory (os error 2)`\n2022-12-05T17:06:25.946079Z  INFO ursa::ursa::identity: Created identity `default` (12D3KooWRis5Gn8TrKNyvx5iizTMKqVyJehw2KRSRAR79FMnxLqQ)\n2022-12-05T17:06:25.946119Z  INFO ursa: Using ursa_db as database path\n2022-12-05T17:06:25.974520Z  INFO ursa_network::discovery: Bootstrapping with [(PeerId("12D3KooWDji7xMLia6GAsyr4oiEFD2dd3zSryqNhfxU3Grzs1r9p"), "/ip4/159.223.211.234/tcp/6009"), (PeerId("12D3KooWGw8vCj9XayJDMXUiox6pCUFm7oVuWkDJeE2H9SDQVEcM"), "/ip4/146.190.232.131/tcp/6009")]\n2022-12-05T17:06:25.975579Z  INFO ursa_rpc_server::server: Server (Rpc and http) starting up\n2022-12-05T17:06:25.975618Z  INFO ursa_index_provider::provider: index provider starting up\n2022-12-05T17:06:25.975632Z  INFO ursa_rpc_server::server: listening on 0.0.0.0:4069\n2022-12-05T17:06:25.975806Z  INFO ursa_index_provider::provider: index provider listening on: 0.0.0.0:8070\n2022-12-05T17:06:25.975553Z  INFO ursa_network::service: Node starting up with peerId PeerId("12D3KooWRis5Gn8TrKNyvx5iizTMKqVyJehw2KRSRAR79FMnxLqQ")\n2022-12-05T17:06:25.975885Z  INFO ursa_metrics::metrics: listening on 0.0.0.0:4070\n')),(0,o.kt)("p",null,"Or, you might find familiar,"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'nginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:17 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:22 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:27 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:32 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:37 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:42 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:47 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:52 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:08:57 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:02 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:07 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:12 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:17 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:22 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\nnginx_1          | 172.19.0.3 - - [06/Jan/2023:19:09:27 +0000] "GET /stub_status HTTP/1.1" 200 100 "-" "Go-http-client/1.1" "-"\n')),(0,o.kt)("p",null,"A few points to notice are the listener port number and hostname \ud83d\udc40. As described in the ",(0,o.kt)("a",{parentName:"p",href:"#run-the-docker-container"},"Run the Docker container"),", the container listener port number is exposed to your host's port number."),(0,o.kt)("h3",{id:"ursa-healthcheck"},"Ursa healthcheck"),(0,o.kt)("p",null,"Here's an example of a curl request for the http headers, as a quick healthcheck."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"curl -I 127.0.0.1:4069\n")),(0,o.kt)("p",null,"The output displays some http headers:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"HTTP/1.1 405 Method Not Allowed\ncontent-length: 0\ndate: Tue, 06 Dec 2022 17:09:16 GMT\n")),(0,o.kt)("p",null,"For users who need high customisation \ud83d\ude0e, the Docker port binding is an important concept to understand when working with containers \ud83e\uddd0. For example, we can extend the previous ",(0,o.kt)("inlineCode",{parentName:"p"},"p")," by providing."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"-p <HOST-ADDRESS>:<CONTAINER-PORT>:<HOST-PORT>\n")),(0,o.kt)("p",null,"Following up \ud83d\udc47, we'll look into how to control Ursa via the container's processes, to help you understand a bit more of Ursa. This can be useful, if you want to follow some of ursa subcommands explained in the ",(0,o.kt)("a",{parentName:"p",href:"fleek-network-getting-started-guide"},"Fleek Network: Getting started guide"),", or if you need to interact with the process in the container:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#stop-the-docker-container"},"Stop the Docker container")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#restart-the-docker-container"},"Restart the Docker container")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#delete-the-docker-container"},"Delete the Docker container")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#execute-bash-shell-in-the-container"},"Execute bash shell in the container")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#stop-the-docker-container"},"Stop the Docker container"))),(0,o.kt)("p",null,"If you are not interested in this level of control and detail \ud83d\ude39, or rather check these later, you can skip to ",(0,o.kt)("a",{parentName:"p",href:"#running-a-stack-with-docker-compose"},"running a stack with Docker compose"),", the simplest and opinionated way to start Ursa along other services to help you monitor, etc."),(0,o.kt)("h2",{id:"utility-commands"},"Utility commands"),(0,o.kt)("h3",{id:"stop-the-docker-container"},"Stop the Docker container"),(0,o.kt)("p",null,"After you're done with the process \u23f3, the Docker container can be stopped by:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker stop <CONTAINER-NAME>\n")),(0,o.kt)("p",null,"In our case, we'd like to stop ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker stop ursa-cli\n")),(0,o.kt)("h3",{id:"restart-the-docker-container"},"Restart the Docker container"),(0,o.kt)("p",null,"After the initial run of the project Dockerfile image, we can restart it by the container name:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker start <CONTAINER-NAME>\n")),(0,o.kt)("p",null,"Our container name is ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli"),", so we do:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker start ursa-cli\n")),(0,o.kt)("p",null,"We haven't set any of the host or port number bindings, that information is part of the metadata of a container, which is immutable, it's persistant."),(0,o.kt)("h3",{id:"delete-the-docker-container"},"Delete the Docker container"),(0,o.kt)("p",null,"The Docker container can be removed by:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker rm <CONTAINER-NAME>\n")),(0,o.kt)("p",null,"For what matters to us, we'd like to delete ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker rm ursa-cli\n")),(0,o.kt)("p",null,"When we delete a container, it's no longer available and thus we'd have to ",(0,o.kt)("a",{parentName:"p",href:"#run-the-docker-container"},"Docker run")," \ud83d\udc77."),(0,o.kt)("h3",{id:"execute-ursa-cli-commands-in-the-container"},"Execute Ursa CLI commands in the container"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it <CONTAINER-NAME> <FILEPATH> <ARGS>\n")),(0,o.kt)("p",null,"For example, we'll interact with the container named ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli")," and execute ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," which is located in the ",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/local/bin"),", with the flag ",(0,o.kt)("inlineCode",{parentName:"p"},"version")," to get the version number of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa cli")," we are running."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it ursa-cli ursa --version\n")),(0,o.kt)("p",null,"If successful, you'll get the version number (beware that version might differ from time of writing, as Ursa is in constant development)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ursa 0.1.0\n")),(0,o.kt)("h3",{id:"execute-bash-shell-in-the-container"},"Execute bash shell in the container"),(0,o.kt)("p",null,"Start the bash shell in the container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it <CONTAINER-NAME> bash\n")),(0,o.kt)("p",null,"As we have ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli")," for our container name example, do:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it ursa-cli bash\n")),(0,o.kt)("p",null,"\ud83d\udc69\u200d\ud83d\udcbb Here, we're just looking into how to execute a process in the container where host and port binding is still relevant and required to be applied if you haven't, otherwise your host will not have the correct bindings. Bear in mind that Docker executes a process in the container, not your host!"),(0,o.kt)("p",null,"For example, we could then check the ",(0,o.kt)("inlineCode",{parentName:"p"},"help")," flag."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ursa --help\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"CLI options\n\nUSAGE:\n    ursa [FLAGS] [OPTIONS] [SUBCOMMAND]\n\nFLAGS:\n    -h, --help       Prints help information\n    -r, --rpc        Allow rpc to be active or not (default = true)\n    -V, --version    Prints version information\n\nOPTIONS:\n    -c, --config <config>                  A toml file containing relevant configurations\n    -d, --database-path <database-path>    Database path where store data\n    -i, --identity <identity>              Identity name. If not provided, a default identity will be created and reused\n                                           automatically\n    -k, --keystore-path <keystore-path>    Path to the keystore directory. Defaults to ~/.config/ursa/keystore\n    -r, --rpc-port <rpc-port>              Port used for JSON-RPC communication\n\nSUBCOMMANDS:\n    help    Prints this message or the help of the given subcommand(s)\n    rpc     run rpc commands from cli\n")),(0,o.kt)("p",null,"\ud83d\udca1 At time of writing the Docker build places the ursa binary in the pathname ",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/local/bin"),", making ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," globally executable. On previous Dockerfile versions it was located in ",(0,o.kt)("inlineCode",{parentName:"p"},"/"),", we had to execute it with the absolute path ",(0,o.kt)("inlineCode",{parentName:"p"},"/ursa --help"),". Pull the latest from the repository and build if you are finding you have to use the deprecated method. In any case, either running on Docker or a Host machine, make sure the directory location where the ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," binary is stored is declared in the system's PATH environment variable."),(0,o.kt)("p",null,"Executing the bash shell in the container is not mandatory and what we shared here is to demonstrate how to interact with the ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," process for the users that don't have it on their local machines and/or are interested in checking subcommands, learning, following tutorials, etc in the same way someone who have it installed in their operating system would."),(0,o.kt)("h2",{id:"run-the-container-from-the-recommended-stack"},"Run the container from the recommended stack"),(0,o.kt)("p",null,"Stack is a way to describe a list of services (applications), we'll have running in our network and Docker Compose is a tool for defining and running multi-container Docker applications (services)."),(0,o.kt)("p",null,"We'll find out how to run an opinionated stack to help us run Fleek Network, with monitoring, etc."),(0,o.kt)("p",null,"Also, by using Docker compose it'll be easier to persist the configuration files (config.toml, identity, etc). Therefore, this is the recommended way to run a node in a docker container."),(0,o.kt)("h3",{id:"running-a-stack-with-docker-compose"},"Running a stack with Docker compose"),(0,o.kt)("p",null,"We have defined a Stack \ud83d\udd78 that can be useful for running and monitoring; At time of writing, this is declared in a docker-compose file located ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/cfbbe6208dc6a33d28b43c6e6820ab76c2905353/infra/ursa/docker-compose.yml"},"here"),"."),(0,o.kt)("p",null,"There you'll find specified all the configuration options, such as the ones we've discussed in the previous topics about the host, port bindings, bind mount, etc. You don't have to constantly verify if specified all the correct options when running the Docker containers. Plus, we have these setup for you ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/"},"grafana"),", ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/introduction/overview/"},"prometheus"),", ",(0,o.kt)("a",{parentName:"p",href:"https://certbot.eff.org/"},"certbot")," and ",(0,o.kt)("a",{parentName:"p",href:"https://www.nginx.com/"},"nginx"),". "),(0,o.kt)("p",null,"Also, the docker compose file can be customized to your preference, Docker will detect any changes recreating the container if and when necessary."),(0,o.kt)("p",null,"For this guide \ud83d\udcd2, we'll look into how to start and stop the stack only!"),(0,o.kt)("p",null,"Before proceeding, make sure you have the image ready! If you haven't already a quick utility method is available as the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"make compose-build\n")),(0,o.kt)("p",null,"\ud83d\udca1 If you have compose-build previously, you'll find that some services will be skipped, such as for the ones which we have set as imagens and don't have to build."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"certbot uses an image, skipping\nnginx uses an image, skipping\nnginxexporter uses an image, skipping\nprometheus uses an image, skipping\ngrafana uses an image, skipping\n")),(0,o.kt)("p",null,"\ud83d\udca1 The ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa")," Docker image should be built every time you want to pull and use an update, learn how by following the guide ",(0,o.kt)("a",{parentName:"p",href:"#fleek-network-how-to-get-the-latest-updates-for-ursa-cli-from-the-source-repository"},"here"),"."),(0,o.kt)("p",null,"In the project root, execute the docker-compose command by providing the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," configuration file and the subcommand up."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f <DOCKER-COMPOSE-FILEPATH> <up | down>\n")),(0,o.kt)("p",null,"For our use-case, here's how it'll look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker/full-node/docker-compose.yml up\n")),(0,o.kt)("p",null,"Where for stopping, you have option ",(0,o.kt)("inlineCode",{parentName:"p"},"down"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker/full-node/docker-compose.yml down\n")),(0,o.kt)("p",null,"Also, we provide the following utility commands for your convenience."),(0,o.kt)("p",null,"A command to execute the docker compose up:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"make compose-up\n")),(0,o.kt)("p",null,"Also, to execute the docker compose down:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"make compose-down\n")),(0,o.kt)("p",null,"Here, we have an opinionated stack that you can use as a base for your system, or as a reference, for your research and learning. This means you aren't obligated to use Grafana or Prometheus. Ursa works without any dependency!"),(0,o.kt)("p",null,"\ud83d\udca1 Learn more about ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"docker compose")," by checking the documentation ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"here"),"."),(0,o.kt)("p",null,"If you'd like to use some of the points available in the guide, such as to ",(0,o.kt)("a",{parentName:"p",href:"#execute-bash-shell-in-the-container"},"execute bash shell in the container"),", you need to ensure that the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa/blob/cfbbe6208dc6a33d28b43c6e6820ab76c2905353/infra/ursa/docker-compose.yml"},"Docker compose file")," have set the ",(0,o.kt)("inlineCode",{parentName:"p"},"container_name")," to the name of your preference for our examples we chose ",(0,o.kt)("inlineCode",{parentName:"p"},"ursa-cli"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"  ursa:\n    container_name: ursa-cli\n    ...\n")),(0,o.kt)("p",null,"At time of writing, you'll find that the output presents errors. The setup we have is based on our staging server use-case, which can be used as an example for yours."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'nginx_1          | 2023/01/06 13:38:44 [emerg] 10#10: open() "/etc/letsencrypt/options-ssl-nginx.conf" failed (2: No such file or directory) in /etc/nginx/conf.d/app.conf:52\nnginxexporter_1  | time="2023-01-06T13:48:07Z" level=error msg="Error scraping nginx: Error scraping nginx: Get http://nginx:80/stub_status: dial tcp: lookup nginx on 127.0.0.11:53: no such host" source="nginx_exporter.go:171"\n')),(0,o.kt)("p",null,"To mitigate this issue, you'll have to run a script from the directory ",(0,o.kt)("inlineCode",{parentName:"p"},"docker/full-node")," of the Ursa project."),(0,o.kt)("p",null,"Start by changing the directory to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cd ./docker/full-node\n")),(0,o.kt)("p",null,"The command you'll be running needs to be prefixed by a list of custom domain names"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'DOMAINS="<YOUR-CUSTOM-DOMAIN-NAME-1> <YOUR-CUSTOM-DOMAIN-NAME-2>" ./init-letsencrypt.sh\n')),(0,o.kt)("p",null,"Here's a practical example,"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'DOMAINS="my-fleek-network-node.dev www.my-fleek-network-node.dev" ./init-letsencrypt.sh\n')),(0,o.kt)("p",null,"If you haven't set up the domain correctly, you'd get"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"Certbot failed to authenticate some domains (authenticator: webroot). The Certificate Authority reported these problems:\n  Domain: my-fleek-network-node.dev\n  Type:   unauthorized\n  Detail: 2001:4860:4802:32::15: Invalid response from https://www.foobar.dev/.well-known/acme-challenge/3UrSvBmgSNsymLKA20wGKJfxQq_utTKlsTLxltTGNQ4: 403\n\nHint: The Certificate Authority failed to download the temporary challenge files created by Certbot. Ensure that the listed domains serve their content from the provided --webroot-path/-w and that files created there can be downloaded from the internet.\n")),(0,o.kt)("p",null," \ud83d\udca1 We'll provide a guide with instructions about how to set up the custom domains."),(0,o.kt)("h3",{id:"disabling-ssl-for-testing"},"Disabling SSL for testing"),(0,o.kt)("p",null,"\u26a0\ufe0f A secure connection is mandatory, the following instructions are available for testing purposes only!"),(0,o.kt)("p",null,"As many of you might not have a custom domain and are just looking around to see what Fleek Network is about, a way around would be to disable SSL for testing, which means that the communication is none secure.\nTo learn how to secure the Node, find our guide ",(0,o.kt)("a",{parentName:"p",href:"fleek-network-securing-a-node-with-ssl-tls"},"Securing a Node with SSL/TLS"),"."),(0,o.kt)("p",null,"Open and edit the file ",(0,o.kt)("inlineCode",{parentName:"p"},"docker/full-node/data/nginx/app.conf")," and make the content the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'proxy_cache_path /cache keys_zone=nodecache:100m levels=1:2 inactive=31536000s max_size=10g use_temp_path=off;\n\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name node.ursa.earth www.node.ursa.earth;\n\n    location /stub_status {\n      stub_status;\n    }\n\n    proxy_redirect          off;\n    client_max_body_size    10m;\n    client_body_buffer_size 128k;\n    proxy_connect_timeout   90;\n    proxy_send_timeout      90;\n    proxy_read_timeout      90;\n    proxy_buffers           32 128k;\n\n    location / {\n      add_header content-type  application/vnd.ipld.raw;\n      add_header content-type  application/vnd.ipld.car;\n      add_header content-type  application/octet-stream;\n      add_header cache-control public,max-age=31536000,immutable;\n\n      proxy_cache nodecache;\n      proxy_cache_valid 200 31536000s;\n      add_header X-Proxy-Cache $upstream_cache_status;\n      proxy_cache_methods GET HEAD POST;\n      proxy_cache_key "$request_uri|$request_body";\n      client_max_body_size 1G;\n\n      proxy_pass http://ursa:4069;\n    }\n}\n')),(0,o.kt)("p",null,"Want to secure your node? We have a brief guide on ",(0,o.kt)("a",{parentName:"p",href:"fleek-network-securing-a-node-with-ssl-tls"},"Securing a Node with SSL/TLS"),"."),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"Containers are a way to have a self-contained environment that includes all necessary dependencies, libraries, software, etc, required to run an application \ud83c\udf70."),(0,o.kt)("p",null,"Fleek Network's Ursa is developed with ",(0,o.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/"},"Rust"),", a general-purpose programming language, that requires several dependencies and libraries to compile the project. Some of these libraries are not installed by default \ud83e\udd16 and require some troubleshooting for the end user. ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," provides us with containers, self-containing all the required libraries for the purpose of running Ursa, our application."),(0,o.kt)("p",null,"We guided you through the initial installation steps, and how to build a ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," image, which then's used to Docker run a container. Plus, provided lower-level commands, to help you understand other present or advanced use-cases, and also at higher level, offerring simple utility methods."),(0,o.kt)("p",null,"While we do our best to provide the clearest instructions, there's always space for improvement, therefore feel free to make any contributions by messaging us on our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"Discord")," or by opening a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network"},"PR")," in any of our repositories \ud83d\ude4f."),(0,o.kt)("p",null,"Discover more about the project by ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa"},"watching/contributing on Github"),", following us on ",(0,o.kt)("a",{parentName:"p",href:"https://twitter.com/fleek_net"},"Twitter"),", and joining ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"our community Discord")," for all the best updates!"),(0,o.kt)(i.Z,{name:"Helder Oliveira",image:"https://github.com/heldrida.png",title:"Software Developer + DX",url:"https://github.com/heldrida",mdxType:"Author"}))}k.isMDXComponent=!0},1026:(e,t,n)=>{n.d(t,{ZP:()=>i});var a=n(7462),o=(n(7294),n(3905));const r={toc:[]};function i(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},r,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\ud83e\udd16 As Fleek Network's repositories are in constant development and change, you should consider that the following guide was ",(0,o.kt)("a",{parentName:"p",href:"https://git-scm.com/docs/git-checkout"},"checked in")," to commit ",(0,o.kt)("inlineCode",{parentName:"p"},"676b01d"),". While we try our best to update documentation and guides during development, there might be breaking changes that might take some time to reflect in our docs. To avoid disappointment, feel free to check into commit ",(0,o.kt)("inlineCode",{parentName:"p"},"676b01d")," or contribute by getting in touch with us, or sending a PR in the relevant context. Learn how to checkout a commit in our repository history ",(0,o.kt)("a",{parentName:"p",href:"../../reference/Git/how-to-checkout-a-commit-in-project-history"},"here")," \ud83d\ude4f.")))}i.isMDXComponent=!0},2915:(e,t,n)=>{n.d(t,{ZP:()=>i});var a=n(7462),o=(n(7294),n(3905));const r={toc:[]};function i(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},r,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You have several ways of doing this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Clone via HTTPS"),(0,o.kt)("li",{parentName:"ul"},"Clone via SSH"),(0,o.kt)("li",{parentName:"ul"},"Download via Github CLI"),(0,o.kt)("li",{parentName:"ul"},"Download the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/fleek-network/ursa/archive/refs/heads/main.zip"},"zip package")," from the repository")),(0,o.kt)("p",null,"We recommend HTTPS because it is the easiest to set up on the wild, and by users who are new to all this."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"git clone https://github.com/fleek-network/ursa.git\n")),(0,o.kt)("p",null,"Although, we strongly recommend using an SSH connection when interacting with GitHub. If you are to this and are interested read more about it ",(0,o.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/connecting-to-github-with-ssh"},"here"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"git clone git@github.com:fleek-network/ursa.git\n")))}i.isMDXComponent=!0},3872:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294);const o=e=>{let{image:t,name:n,title:o,url:r}=e;return a.createElement("section",{className:"author_card"},a.createElement("div",null,a.createElement("span",{className:"avatar"},a.createElement("a",{href:r,target:"_blank",alt:n},a.createElement("img",{src:t,alt:n}))),a.createElement("div",null,a.createElement("span",{className:"name"},a.createElement("a",{href:r,target:"_blank",alt:n},n)),a.createElement("span",{className:"title"},o),a.createElement("span",{className:"discord"},"Got questions? Find us on ",a.createElement("a",{href:"https://discord.gg/fleekxyz",target:"_blank"},"Discord!")))))}},4456:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294);const o=e=>{let{videoId:t,title:n}=e;return a.createElement("div",{className:"youtube-player"},a.createElement("iframe",{src:`https://www.youtube.com/embed/${t}?controls=1&modestbranding=1&playsinline=1&rel=0`,title:n,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}))}},4852:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fleek-network-docker-setup-overview-21d7c36e90ff938ceeea51a18002fd27.png"}}]);